<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ubicaci√≥n en tiempo real - Firebase + Mapbox</title>

  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">

  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f6f8fb; text-align: center; }
    h1 { background: #0078A8; color: white; padding: 10px; margin: 0; }
    #map { width: 90%; height: 500px; margin: 20px auto; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    #info { background: white; width: 80%; margin: 10px auto; padding: 10px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
<h1>SERGIO HECTOR SOLIZ CALLE</h1>
<div id="map"></div>
<div id="info">
  <p><strong>ID:</strong> <span id="id">Esperando...</span></p>
  <p><strong>Latitud:</strong> <span id="lat">--</span></p>
  <p><strong>Longitud:</strong> <span id="lon">--</span></p>
  <p><strong>Hora:</strong> <span id="hora">--</span></p>
</div>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAMcViYmKEKiwqREO8zSt1QXKYF2SgIfiA",
    authDomain: "mapa-b374f.firebaseapp.com",
    databaseURL: "https://mapa-b374f-default-rtdb.firebaseio.com",
    projectId: "mapa-b374f",
    storageBucket: "mapa-b374f.firebasestorage.app",
    messagingSenderId: "979846724625",
    appId: "1:979846724625:web:03e8d9706c1bcaf5e985b0",
    measurementId: "G-VPZBG436FL"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  mapboxgl.accessToken = 'pk.eyJ1IjoiY2hleHhvbyIsImEiOiJjbWhldGxqbXkwM2Q5Mmlwemd0dzN2N3RnIn0.GTA2Z9-w_79fnjJW8equig';

  window.onload = () => {
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [-68.1193, -16.5000],
      zoom: 13
    });
    map.addControl(new mapboxgl.NavigationControl());

    let marker = null;

    // Tu device ID
    const deviceId = "c02662f7eceb5744";

    // Referencia directa a la carpeta del dispositivo
    const ubicacionRef = ref(db, `Ubicaciones/${deviceId}`);

    onValue(ubicacionRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      const lat = parseFloat(data.latitud);
      const lon = parseFloat(data.longitud);

      if (!isNaN(lat) && !isNaN(lon)) {
        if (!marker) {
          marker = new mapboxgl.Marker({ color: 'red' }).setLngLat([lon, lat]).addTo(map);
          map.setCenter([lon, lat]);
        } else {
          marker.setLngLat([lon, lat]);
        }

        document.getElementById("id").textContent = data.idDispositivo || "Desconocido";
        document.getElementById("lat").textContent = lat.toFixed(5);
        document.getElementById("lon").textContent = lon.toFixed(5);
        document.getElementById("hora").textContent = data.hora || "--";
      }
    });
  };
</script>
</body>
</html>

